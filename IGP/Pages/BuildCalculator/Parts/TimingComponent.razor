@inject IJSRuntime jsRuntime;

@inject IBuildOrderService buildOrderService
@inject IEconomyService economyService
@inject IToastService toastService
@inject ITimingService timingService

<FormLayoutComponent>
    <FormNumberComponent Max="2048"
                         Min="0"
                         Value="@timingService.GetTiming()"
                         OnChange="@OnTimingChanged">
        <FormLabelComponent>Timing interval</FormLabelComponent>
        <FormInfoComponent>Altering the time interval is currently disabled.</FormInfoComponent>
    </FormNumberComponent>

    <FormTextComponent Label="Name" Placeholder="Fast Thrones..." Value="@buildOrderService.GetName()" OnChange="OnNameChanged"/>

    <FormTextAreaComponent Label="Notes"
                           Value="@buildOrderService.GetNotes()"
                           OnChange="@OnNotesChanged">
    </FormTextAreaComponent>
    <FormTextComponent Label="Color" Placeholder="red..." Value="@buildOrderService.GetColor()" OnChange="OnColorChanged"/>
</FormLayoutComponent>

@code {

    void OnTimingChanged(ChangeEventArgs changeEventArgs)
    {
        timingService.SetTiming(int.Parse(changeEventArgs.Value!.ToString()!));
        economyService.Calculate(buildOrderService, timingService, buildOrderService.GetLastRequestInterval());
        toastService.AddToast(new ToastModel()
        {
            Title = "Timing Interval", 
            Message = "Timing interval has changed.", 
            SeverityType = SeverityType.Success
        });
    }

    void OnNameChanged(ChangeEventArgs changeEventArgs)
    {
        buildOrderService.SetName(changeEventArgs.Value!.ToString()!);
    }

    void OnColorChanged(ChangeEventArgs changeEventArgs)
    {
        buildOrderService.SetColor(changeEventArgs.Value!.ToString()!);
    }


    void OnNotesChanged(ChangeEventArgs changeEventArgs)
    {
        buildOrderService.SetNotes(changeEventArgs.Value!.ToString()!);
    }

    protected override bool ShouldRender()
    {
#if DEBUG
        jsRuntime.InvokeVoidAsync("console.time", "TimingComponent");
#endif

        return true;
    }

    protected override void OnAfterRender(bool firstRender)
    {
#if DEBUG
        jsRuntime.InvokeVoidAsync("console.timeEnd", "TimingComponent");
#endif
    }

}