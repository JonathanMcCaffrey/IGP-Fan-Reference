@using Services
@inject IToastService toastService

@implements IDisposable

@if (Toast == null)
{
    <div>Add toast object...</div>
}
else
{
    <div onclick="@Dismiss" class="toastContainer @FadeoutStyle @Toast.SeverityType.ToLower()">
        <div class="toastTitle">
            @Toast.Title
        </div>
            <div>
                @Toast.Message
            </div>
    </div>    
}

<style>
    .toastContainer {
        border: 4px solid;
        border-radius: 4px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        justify-items: stretch;
        width: 250px;
        opacity: 1;
        cursor: pointer;
    }
    
    .fadeout {
        transition: opacity 3s ease-in;
        opacity: 0;
    }

    .@SeverityType.Warning.ToLower() {
        background-color: var(--severity-warning-color);
        border-color: var(--severity-warning-border-color);
    }

    .@SeverityType.Error.ToLower() {
        background-color: var(--severity-error-color);
        border-color: var(--severity-error-border-color);
    }

    .@SeverityType.Information.ToLower() {
        background-color: var(--severity-information-color);
        border-color: var(--severity-information-border-color);
    }

    .@SeverityType.Success.ToLower() {
        background-color: var(--severity-success-color);
        border-color: var(--severity-success-border-color);
    }

    .toastTitle {
        font-weight: 800;
    }

</style>

@code {
        
    [Parameter]
    public ToastModel? Toast { get; set; } = default!;

    private bool isFadingOut = false;

    private string FadeoutStyle => isFadingOut ? "fadeout" : "";

    private int removalTime = 150000;
    private int fadeoutTime = 1000;

    private Timer removalTimer = null!;
    private Timer fadeoutTimer = null!;

    protected override void OnInitialized()
    {
#if DEBUG
        removalTime = 8000;
#endif

        removalTimer = new Timer(removalTime);
        removalTimer.Elapsed += OnRemoval!;
        removalTimer.Enabled = true;
        
        fadeoutTimer = new Timer(removalTime - fadeoutTime);
        fadeoutTimer.Elapsed += OnFadeout!;
        fadeoutTimer.Enabled = true;
        
        toastService.Subscribe(StateHasChanged);
    }

    void OnFadeout(object source, ElapsedEventArgs eventArgs)
    {
     //   isFadingOut = true;
        
        StateHasChanged();
    }
    
    void OnRemoval(object source, ElapsedEventArgs eventArgs)
    {
        //toastService.RemoveToast(Toast!);
        
        StateHasChanged();
    }

    void Dismiss()
    {
        toastService.RemoveToast(Toast!);
    }

    public void Dispose()
    {
        removalTimer.Elapsed -= OnRemoval!;
        fadeoutTimer.Elapsed -= OnFadeout!;
        
        toastService.Unsubscribe(StateHasChanged);
    }
}